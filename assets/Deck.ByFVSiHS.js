import{j as s}from"./jsx-runtime.D_zvdyIk.js";import{r as t}from"./index.BVOCwoKb.js";import{M as G,u as Y,P as B,a as U,b as q,L as V,m as X}from"./proxy.DRJjp7h_.js";class Q extends t.Component{getSnapshotBeforeUpdate(a){const n=this.props.childRef.current;if(n&&a.isPresent&&!this.props.isPresent){const r=n.offsetParent,f=r instanceof HTMLElement&&r.offsetWidth||0,d=this.props.sizeRef.current;d.height=n.offsetHeight||0,d.width=n.offsetWidth||0,d.top=n.offsetTop,d.left=n.offsetLeft,d.right=f-d.width-d.left}return null}componentDidUpdate(){}render(){return this.props.children}}function ee({children:e,isPresent:a,anchorX:n}){const r=t.useId(),f=t.useRef(null),d=t.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:c}=t.useContext(G);return t.useInsertionEffect(()=>{const{width:h,height:m,top:M,left:g,right:v}=d.current;if(a||!f.current||!h||!m)return;const S=n==="left"?`left: ${g}`:`right: ${v}`;f.current.dataset.motionPopId=r;const l=document.createElement("style");return c&&(l.nonce=c),document.head.appendChild(l),l.sheet&&l.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${h}px !important;
            height: ${m}px !important;
            ${S}px !important;
            top: ${M}px !important;
          }
        `),()=>{document.head.removeChild(l)}},[a]),s.jsx(Q,{isPresent:a,childRef:f,sizeRef:d,children:t.cloneElement(e,{ref:f})})}const te=({children:e,initial:a,isPresent:n,onExitComplete:r,custom:f,presenceAffectsLayout:d,mode:c,anchorX:h})=>{const m=Y(ne),M=t.useId();let g=!0,v=t.useMemo(()=>(g=!1,{id:M,initial:a,isPresent:n,custom:f,onExitComplete:S=>{m.set(S,!0);for(const l of m.values())if(!l)return;r&&r()},register:S=>(m.set(S,!1),()=>m.delete(S))}),[n,m,r]);return d&&g&&(v={...v}),t.useMemo(()=>{m.forEach((S,l)=>m.set(l,!1))},[n]),t.useEffect(()=>{!n&&!m.size&&r&&r()},[n]),c==="popLayout"&&(e=s.jsx(ee,{isPresent:n,anchorX:h,children:e})),s.jsx(B.Provider,{value:v,children:e})};function ne(){return new Map}const H=e=>e.key||"";function W(e){const a=[];return t.Children.forEach(e,n=>{t.isValidElement(n)&&a.push(n)}),a}const se=({children:e,custom:a,initial:n=!0,onExitComplete:r,presenceAffectsLayout:f=!0,mode:d="sync",propagate:c=!1,anchorX:h="left"})=>{const[m,M]=U(c),g=t.useMemo(()=>W(e),[e]),v=c&&!m?[]:g.map(H),S=t.useRef(!0),l=t.useRef(g),j=Y(()=>new Map),[N,D]=t.useState(g),[I,i]=t.useState(g);q(()=>{S.current=!1,l.current=g;for(let w=0;w<I.length;w++){const o=H(I[w]);v.includes(o)?j.delete(o):j.get(o)!==!0&&j.set(o,!1)}},[I,v.length,v.join("-")]);const u=[];if(g!==N){let w=[...g];for(let o=0;o<I.length;o++){const p=I[o],x=H(p);v.includes(x)||(w.splice(o,0,p),u.push(p))}return d==="wait"&&u.length&&(w=u),i(W(w)),D(g),null}const{forceRender:C}=t.useContext(V);return s.jsx(s.Fragment,{children:I.map(w=>{const o=H(w),p=c&&!m?!1:g===I||v.includes(o),x=()=>{if(j.has(o))j.set(o,!0);else return;let y=!0;j.forEach(E=>{E||(y=!1)}),y&&(C?.(),i(l.current),c&&M?.(),r&&r())};return s.jsx(te,{isPresent:p,initial:!S.current||n?void 0:!1,custom:a,presenceAffectsLayout:f,mode:d,onExitComplete:p?void 0:x,anchorX:h,children:w},o)})})};function oe(e=0,a=1){let n=1-Math.random(),r=1-Math.random();n===0&&(n=1e-4),r===0&&(r=1e-4);const f=Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*r);return e+a*f}function O(e,a,n){return Math.min(Math.max(e,a),n)}function F(e,a){return{x:e*Math.cos(a),y:e*Math.sin(a)}}function T(e,a,n,r=280,f=120,d=20){const c=a/2-r/2-d,h=n/2-f/2-d;return e.x>=-c&&e.x<=c&&e.y>=-h&&e.y<=h}const L="cardPositions";function ie({article:e,index:a,safeRadius:n=200,debugMode:r,zIndex:f}){const d=t.useRef(null),[c,h]=t.useState(null),[m,M]=t.useState(0),[g,v]=t.useState(!1),{updateZIndex:S,totalCards:l,hoveredCard:j,setHoveredCard:N}=t.useContext(_),D=x=>x?new Date(x).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric"}):"";t.useEffect(()=>{const x=y=>{y.key==="r"&&y.shiftKey&&(console.log("Clearing all saved card positions"),localStorage.removeItem(L),window.location.reload())};return window.addEventListener("keydown",x),()=>window.removeEventListener("keydown",x)},[]),t.useEffect(()=>{try{const x=window.innerWidth,y=window.innerHeight,E=localStorage.getItem(L);let b,z=!1;if(E&&(b=JSON.parse(E)[e.slug],b&&!T(b,x,y)&&(console.log(`Card "${e.slug}" is outside bounds, repositioning`),z=!0)),b&&!z)h(b);else{const P=Math.abs(oe(0,n/3)),R=Math.random()*2*Math.PI,$=O(P,0,n*.9);let k=F($,R);if(!T(k,x,y)){const J=x/2-160,K=y/2-80;k={x:O(k.x,-J,J),y:O(k.y,-K,K)}}h(k),M(Math.round($/n*100));const Z=E?JSON.parse(E):{};Z[e.slug]=k,localStorage.setItem(L,JSON.stringify(Z))}}catch(x){console.warn("Failed to handle card position",x);const y=Math.random()*2*Math.PI,E=Math.random()*n*.5;h(F(E,y))}},[e.slug,n]);const I=()=>{v(!0),N(e.slug)},i=()=>{v(!1),j===e.slug&&N(null)},u=()=>{S(e.slug)},C=(x,y)=>{if(!c)return;let E={x:c.x+y.offset.x,y:c.y+y.offset.y};const b=window.innerWidth,z=window.innerHeight;if(!T(E,b,z)){const P=b/2-160,R=z/2-80;E={x:O(E.x,-P,P),y:O(E.y,-R,R)}}h(E);try{const P=localStorage.getItem(L),R=P?JSON.parse(P):{};R[e.slug]=E,localStorage.setItem(L,JSON.stringify(R))}catch(P){console.warn("Failed to save card position",P)}},w=()=>j===e.slug?l+1e3:f,o=(a%3-1)*5;if(c===null)return null;const p={position:"absolute",left:"50%",top:"50%",marginLeft:"-140px",marginTop:"-60px",zIndex:w(),borderRadius:"12px",backdropFilter:"blur(10px)"};return s.jsxs(X.div,{ref:d,className:`card ${g?"card-hovered":""}`,drag:!0,dragMomentum:!1,onDragStart:u,onDragEnd:C,onClick:u,onMouseEnter:I,onMouseLeave:i,onTouchStart:I,onTouchEnd:i,initial:{opacity:0,scale:0,x:c.x,y:c.y,rotate:o},animate:{opacity:1,scale:1,x:c.x,y:c.y,rotate:o},whileHover:{scale:1.02,transition:{duration:.2}},transition:{delay:a*.15,type:"spring",damping:15,stiffness:150},style:p,children:[s.jsxs("div",{className:"card-content",children:[s.jsx("h2",{children:e.title}),e.date&&s.jsx("div",{className:"card-date",children:D(e.date)}),s.jsx("div",{className:"card-decoration"})]}),s.jsx("a",{href:`/articles/${e.slug}`,className:"card-link",children:"Oku →"}),r&&s.jsxs("div",{className:"card-debug",style:{position:"absolute",top:"2px",left:"2px",fontSize:"8px",backgroundColor:"rgba(0,0,0,0.5)",color:"#fff",padding:"2px 4px",borderRadius:"2px",pointerEvents:"none"},children:["z:",f," ",j===e.slug?"H":""," d:",m,"%"]})]})}const A="cardZIndices",_=t.createContext({updateZIndex:()=>{},totalCards:0,hoveredCard:null,setHoveredCard:()=>{}});function ce({articles:e}){const[a,n]=t.useState(!1),[r,f]=t.useState([]),[d,c]=t.useState({x:0,y:0}),[h,m]=t.useState(0),[M,g]=t.useState(!1),[v,S]=t.useState(!1),[l,j]=t.useState({}),[N,D]=t.useState(null);t.useEffect(()=>{n(!0);const i=[...e].sort((o,p)=>new Date(p.data.date)-new Date(o.data.date));f(i);let u={};try{const o=localStorage.getItem(A);if(o){const p=JSON.parse(o);let x=!0;i.forEach(y=>{y.slug in p||(x=!1)}),x&&(u=p,console.log("Restored z-indices from storage"))}}catch(o){console.warn("Error loading z-indices",o)}Object.keys(u).length===0&&i.forEach((o,p)=>{u[o.slug]=i.length-p}),j(u);const C=()=>{c({x:window.innerWidth/2,y:window.innerHeight/2});const o=Math.min(window.innerWidth,window.innerHeight)*.4;m(o)};C(),window.addEventListener("resize",C);const w=setTimeout(()=>{S(!0)},1800);return()=>{window.removeEventListener("resize",C),clearTimeout(w)}},[e]),t.useEffect(()=>{if(Object.keys(l).length>0)try{localStorage.setItem(A,JSON.stringify(l))}catch(i){console.warn("Error saving z-indices",i)}},[l]);const I=i=>{D(null),j(u=>{const C={...u},w=u[i],o=r.length;return w<o&&(Object.keys(C).forEach(p=>{p!==i&&C[p]>w&&C[p]--}),C[i]=o),M&&console.log(`Card ${i} z-index updated from ${w} to ${C[i]}`),C})};return t.useEffect(()=>{const i=u=>{u.key==="d"&&g(C=>!C)};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[]),a?s.jsx(_.Provider,{value:{updateZIndex:I,totalCards:r.length,hoveredCard:N,setHoveredCard:D},children:s.jsxs("div",{className:"deck",children:[s.jsx(X.div,{className:"site-title",initial:{opacity:0},animate:{opacity:1},transition:{duration:1.5},children:"KENDİME DÜŞÜNCELER"}),s.jsx(se,{children:v&&s.jsxs("div",{className:"cards-container",style:{position:"absolute",left:d.x,top:d.y},children:[M&&s.jsx("div",{className:"debug-circle",style:{position:"absolute",width:h*2+"px",height:h*2+"px",borderRadius:"50%",border:"2px dashed rgba(255, 0, 0, 0.5)",transform:"translate(-50%, -50%)",pointerEvents:"none"}}),r.map((i,u)=>s.jsx(ie,{article:{slug:i.slug,title:i.data.title,date:i.data.date},index:u,zIndex:l[i.slug]||0,safeRadius:h,debugMode:M},i.slug))]})}),M&&s.jsxs("div",{className:"debug-info",style:{position:"fixed",bottom:"10px",left:"10px",background:"rgba(0,0,0,0.7)",color:"white",padding:"10px",borderRadius:"5px",fontSize:"12px",zIndex:9999},children:[s.jsx("p",{children:"Debug Mode: ON (Press 'd' to toggle)"}),s.jsxs("p",{children:["Center: ",d.x.toFixed(0),"px, ",d.y.toFixed(0),"px"]}),s.jsxs("p",{children:["Safe Radius: ",h.toFixed(0),"px"]}),s.jsxs("p",{children:["Cards: ",r.length]}),s.jsxs("p",{children:["Hovered: ",N||"None"]}),M&&s.jsxs("div",{children:[s.jsx("p",{children:"Z-Indices:"}),s.jsx("div",{style:{maxHeight:"100px",overflowY:"auto",fontSize:"10px"},children:Object.entries(l).map(([i,u])=>s.jsxs("div",{children:[i.substring(0,10),": ",u]},i))})]})]})]})}):s.jsx("div",{className:"deck",children:s.jsx("div",{className:"site-title",children:"KENDİME DÜŞÜNCELER"})})}export{ce as default};
