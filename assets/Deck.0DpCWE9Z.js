import{j as n}from"./jsx-runtime.D_zvdyIk.js";import{r as s}from"./index.BVOCwoKb.js";import{m as W,A as $}from"./proxy.D7pFc3Xh.js";function X(e=0,l=1){let i=1-Math.random(),h=1-Math.random();i===0&&(i=1e-4),h===0&&(h=1e-4);const w=Math.sqrt(-2*Math.log(i))*Math.cos(2*Math.PI*h);return e+l*w}function C(e,l,i){return Math.min(Math.max(e,l),i)}function K(e,l){return{x:e*Math.cos(l),y:e*Math.sin(l)}}function L(e,l,i,h=280,w=120,p=20){const u=l/2-h/2-p,f=i/2-w/2-p;return e.x>=-u&&e.x<=u&&e.y>=-f&&e.y<=f}const P="cardPositions";function _({article:e,index:l,safeRadius:i=200,debugMode:h,zIndex:w}){const p=s.useRef(null),[u,f]=s.useState(null),[H,y]=s.useState(0),[z,D]=s.useState(!1),{updateZIndex:R,totalCards:S,hoveredCard:I,setHoveredCard:N}=s.useContext(Y),O=r=>r?new Date(r).toLocaleDateString("tr-TR",{year:"numeric",month:"long",day:"numeric"}):"";s.useEffect(()=>{const r=c=>{c.key==="r"&&c.shiftKey&&(console.log("Clearing all saved card positions"),localStorage.removeItem(P),window.location.reload())};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[]),s.useEffect(()=>{try{const r=window.innerWidth,c=window.innerHeight,x=localStorage.getItem(P);let v,M=!1;if(x&&(v=JSON.parse(x)[e.slug],v&&!L(v,r,c)&&(console.log(`Card "${e.slug}" is outside bounds, repositioning`),M=!0)),v&&!M)f(v);else{const g=Math.abs(X(0,i/3)),j=Math.random()*2*Math.PI,Z=C(g,0,i*.9);let b=K(Z,j);if(!L(b,r,c)){const J=r/2-160,A=c/2-80;b={x:C(b.x,-J,J),y:C(b.y,-A,A)}}f(b),y(Math.round(Z/i*100));const T=x?JSON.parse(x):{};T[e.slug]=b,localStorage.setItem(P,JSON.stringify(T))}}catch(r){console.warn("Failed to handle card position",r);const c=Math.random()*2*Math.PI,x=Math.random()*i*.5;f(K(x,c))}},[e.slug,i]);const k=()=>{D(!0),N(e.slug)},t=()=>{D(!1),I===e.slug&&N(null)},o=()=>{R(e.slug)},d=(r,c)=>{if(!u)return;let x={x:u.x+c.offset.x,y:u.y+c.offset.y};const v=window.innerWidth,M=window.innerHeight;if(!L(x,v,M)){const g=v/2-160,j=M/2-80;x={x:C(x.x,-g,g),y:C(x.y,-j,j)}}f(x);try{const g=localStorage.getItem(P),j=g?JSON.parse(g):{};j[e.slug]=x,localStorage.setItem(P,JSON.stringify(j))}catch(g){console.warn("Failed to save card position",g)}},E=()=>I===e.slug?S+1e3:w,a=(l%3-1)*5;if(u===null)return null;const m={position:"absolute",left:"50%",top:"50%",marginLeft:"-140px",marginTop:"-60px",zIndex:E(),borderRadius:"12px",backdropFilter:"blur(10px)"};return n.jsxs(W.div,{ref:p,className:`card ${z?"card-hovered":""}`,drag:!0,dragMomentum:!1,onDragStart:o,onDragEnd:d,onClick:o,onMouseEnter:k,onMouseLeave:t,onTouchStart:k,onTouchEnd:t,initial:{opacity:0,scale:0,x:u.x,y:u.y,rotate:a},animate:{opacity:1,scale:1,x:u.x,y:u.y,rotate:a},whileHover:{scale:1.02,transition:{duration:.2}},transition:{delay:l*.15,type:"spring",damping:15,stiffness:150},style:m,children:[n.jsxs("div",{className:"card-content",children:[n.jsx("h2",{children:e.title}),e.date&&n.jsx("div",{className:"card-date",children:O(e.date)}),n.jsx("div",{className:"card-decoration"})]}),n.jsx("a",{href:`/articles/${e.slug}`,className:"card-link",children:"Oku →"}),h&&n.jsxs("div",{className:"card-debug",style:{position:"absolute",top:"2px",left:"2px",fontSize:"8px",backgroundColor:"rgba(0,0,0,0.5)",color:"#fff",padding:"2px 4px",borderRadius:"2px",pointerEvents:"none"},children:["z:",w," ",I===e.slug?"H":""," d:",H,"%"]})]})}const F="cardZIndices",Y=s.createContext({updateZIndex:()=>{},totalCards:0,hoveredCard:null,setHoveredCard:()=>{}});function Q({articles:e}){const[l,i]=s.useState(!1),[h,w]=s.useState([]),[p,u]=s.useState({x:0,y:0}),[f,H]=s.useState(0),[y,z]=s.useState(!1),[D,R]=s.useState(!1),[S,I]=s.useState({}),[N,O]=s.useState(null);s.useEffect(()=>{i(!0);const t=[...e].sort((a,m)=>new Date(m.data.date)-new Date(a.data.date));w(t);let o={};try{const a=localStorage.getItem(F);if(a){const m=JSON.parse(a);let r=!0;t.forEach(c=>{c.slug in m||(r=!1)}),r&&(o=m,console.log("Restored z-indices from storage"))}}catch(a){console.warn("Error loading z-indices",a)}Object.keys(o).length===0&&t.forEach((a,m)=>{o[a.slug]=t.length-m}),I(o);const d=()=>{u({x:window.innerWidth/2,y:window.innerHeight/2});const a=Math.min(window.innerWidth,window.innerHeight)*.4;H(a)};d(),window.addEventListener("resize",d);const E=setTimeout(()=>{R(!0)},1800);return()=>{window.removeEventListener("resize",d),clearTimeout(E)}},[e]),s.useEffect(()=>{if(Object.keys(S).length>0)try{localStorage.setItem(F,JSON.stringify(S))}catch(t){console.warn("Error saving z-indices",t)}},[S]);const k=t=>{O(null),I(o=>{const d={...o},E=o[t],a=h.length;return E<a&&(Object.keys(d).forEach(m=>{m!==t&&d[m]>E&&d[m]--}),d[t]=a),y&&console.log(`Card ${t} z-index updated from ${E} to ${d[t]}`),d})};return s.useEffect(()=>{const t=o=>{o.key==="d"&&z(d=>!d)};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[]),l?n.jsx(Y.Provider,{value:{updateZIndex:k,totalCards:h.length,hoveredCard:N,setHoveredCard:O},children:n.jsxs("div",{className:"deck",children:[n.jsx(W.div,{className:"site-title",initial:{opacity:0},animate:{opacity:1},transition:{duration:1.5},children:"KENDİME DÜŞÜNCELER"}),n.jsx($,{children:D&&n.jsxs("div",{className:"cards-container",style:{position:"absolute",left:p.x,top:p.y},children:[y&&n.jsx("div",{className:"debug-circle",style:{position:"absolute",width:f*2+"px",height:f*2+"px",borderRadius:"50%",border:"2px dashed rgba(255, 0, 0, 0.5)",transform:"translate(-50%, -50%)",pointerEvents:"none"}}),h.map((t,o)=>n.jsx(_,{article:{slug:t.slug,title:t.data.title,date:t.data.date},index:o,zIndex:S[t.slug]||0,safeRadius:f,debugMode:y},t.slug))]})}),y&&n.jsxs("div",{className:"debug-info",style:{position:"fixed",bottom:"10px",left:"10px",background:"rgba(0,0,0,0.7)",color:"white",padding:"10px",borderRadius:"5px",fontSize:"12px",zIndex:9999},children:[n.jsx("p",{children:"Debug Mode: ON (Press 'd' to toggle)"}),n.jsxs("p",{children:["Center: ",p.x.toFixed(0),"px, ",p.y.toFixed(0),"px"]}),n.jsxs("p",{children:["Safe Radius: ",f.toFixed(0),"px"]}),n.jsxs("p",{children:["Cards: ",h.length]}),n.jsxs("p",{children:["Hovered: ",N||"None"]}),y&&n.jsxs("div",{children:[n.jsx("p",{children:"Z-Indices:"}),n.jsx("div",{style:{maxHeight:"100px",overflowY:"auto",fontSize:"10px"},children:Object.entries(S).map(([t,o])=>n.jsxs("div",{children:[t.substring(0,10),": ",o]},t))})]})]})]})}):n.jsx("div",{className:"deck",children:n.jsx("div",{className:"site-title",children:"KENDİME DÜŞÜNCELER"})})}export{Q as default};
